{% extends "base.html" %}

{% block title %}Database Connection | Text-to-SQL{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto space-y-12">

  <!-- üß≠ Page Header -->
  <div class="text-center space-y-2">
    <h1 class="text-3xl font-semibold text-gray-800">‚öôÔ∏è Database Connection</h1>
    <p class="text-gray-600 text-sm">
      Connect to your database to automatically extract and understand its schema.
    </p>
  </div>

  {% if error %}
  <div class="p-4 rounded-xl bg-red-100 text-red-700 font-medium border border-red-200 shadow-sm">
    {{ error }}
  </div>
  {% endif %}

  <!-- üîå Connection Form Card -->
  <div class="bg-white/80 backdrop-blur-md rounded-2xl shadow-lg p-8 space-y-8 border border-gray-100">
    <form method="POST" class="space-y-8">

      <!-- Database Type -->
      <div class="space-y-2">
        <label for="db_type" class="block text-sm font-semibold text-gray-700">Database Type</label>
        <select
          id="db_type"
          name="db_type"
          required
          class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm text-gray-700 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
        >
          <option value="postgresql">PostgreSQL</option>
          <option value="mysql">MySQL</option>
          <option value="sqlite">SQLite</option>
        </select>
      </div>

      <!-- Host + Port -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="db_host" class="block text-sm font-semibold text-gray-700">Host</label>
          <input
            type="text"
            id="db_host"
            name="db_host"
            value="localhost"
            required
            class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          />
        </div>
        <div class="space-y-2">
          <label for="db_port" class="block text-sm font-semibold text-gray-700">Port</label>
          <input
            type="text"
            id="db_port"
            name="db_port"
            value="5432"
            class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          />
        </div>
      </div>

      <!-- Database Name -->
      <div class="space-y-2">
        <label for="db_name" class="block text-sm font-semibold text-gray-700">Database Name</label>
        <input
          type="text"
          id="db_name"
          name="db_name"
          value="dezyre_db"
          required
          class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
        />
      </div>

      <!-- Username + Password -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="db_user" class="block text-sm font-semibold text-gray-700">Username</label>
          <input
            type="text"
            id="db_user"
            name="db_user"
            value="dezyre_user"
            required
            class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          />
        </div>
        <div class="space-y-2">
          <label for="db_password" class="block text-sm font-semibold text-gray-700">Password</label>
          <input
            type="password"
            value="dezyre123"
            id="db_password"
            name="db_password"
            class="w-full rounded-lg border border-gray-300 bg-white py-2.5 px-3 text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          />
        </div>
      </div>

      <!-- Submit Button -->
      <div class="pt-4">
        <button
          type="submit"
          class="inline-flex items-center justify-center w-full sm:w-auto gap-2 bg-indigo-600 text-white font-medium text-sm px-6 py-3 rounded-lg shadow-md hover:bg-indigo-700 hover:shadow-lg transition"
        >
          üîó Connect & Load Schema
        </button>
      </div>

    </form>
  </div>

  <!-- üí° Info Card -->
  <div class="bg-indigo-50 border border-indigo-100 rounded-2xl p-6 shadow-sm">
    <h3 class="text-indigo-700 font-semibold mb-3">üí° How It Works</h3>
    <ul class="list-disc list-inside text-gray-700 text-sm space-y-1">
      <li>Connect to your database to automatically extract schema information.</li>
      <li>Schema is embedded as vectors for efficient retrieval.</li>
      <li>Only relevant tables and columns are used for query generation.</li>
      <li>Supports PostgreSQL, MySQL, and SQLite.</li>
    </ul>
  </div>

</div>

<!-- üß† Auto-update port script -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const dbTypeSelect = document.getElementById("db_type");
    const portInput = document.getElementById("db_port");

    const defaultPorts = {
      postgresql: "5432",
      mysql: "3306",
      sqlite: ""
    };

    dbTypeSelect.addEventListener("change", function () {
      const selectedType = dbTypeSelect.value;
      portInput.value = defaultPorts[selectedType] || "";
    });
  });
</script>
{% endblock %}